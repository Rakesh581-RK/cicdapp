trigger:
- main   # Pipeline runs when code is pushed to main branch

pool:
  vmImage: 'ubuntu-latest'

steps:
# 1. Checkout repository
- checkout: self

# 2. Install JDK (Java)
- task: JavaToolInstaller@0
  inputs:
    versionSpec: '17'          # use Java 17 (recommended)
    jdkArchitectureOption: 'x64'
    jdkSourceOption: 'PreInstalled'

# 3. Cache Maven dependencies (faster builds)
- task: Cache@2
  inputs:
    key: 'maven | "$(Agent.OS)" | pom.xml'
    path: ~/.m2/repository
    restoreKeys: |
      maven | "$(Agent.OS)"

# 4. Build the project using Maven
- task: Maven@3
  inputs:
    mavenPomFile: 'pom.xml'
    goals: 'clean install'
    publishJUnitResults: true
    testResultsFiles: '**/surefire-reports/*.xml'
    javaHomeOption: 'JDKVersion'
    jdkVersionOption: '17'
    mavenOptions: '-Xmx2048m'
    sonarQubeRunAnalysis: false

# 5. Publish build artifacts (like JAR/WAR)
- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: 'target'
    ArtifactName: 'drop'
    publishLocation: 'Container'
